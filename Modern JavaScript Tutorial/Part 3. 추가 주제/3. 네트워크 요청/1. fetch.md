# fetch

자바스크립트를 사용하면 필요할 때 서버에 네트워크 요청을 보내고 새로운 정보를 받아오는 일을 할 수 있다.

네트워크 요청은 다음과 같은 경우에 이뤄진다.

- 주문 전송
- 사용자 정보 읽기
- 서버에서 최신 변경분 가져오기
- 등등

그런데 이 모든 것들은 페이지 새로 고침 없이도 가능하다.

AJAX(**A**synchronous **J**avaScript **A**nd **X**ML, 비동기적 JavaScript와 XML)라는 용어를 들어본 적이 있을 것이다. AJAX는 서버에서 추가 정보를 비동기적으로 가져올 수 있게 해주는 포괄적인 기술을 나타내는 용어로, 만들어진 지 오래되었다. AJAX에 XML이 포함된 이유가 바로 이 때문이다.

AJAX 이외에도 서버에 네트워크 요청을 보내고 정보를 받아올 수 있는 방법은 다양하다.

그중 이번 챕터에선 모던하고 다재다능한 `fetch()` 메서드에 대해 소개한다. `fetch()`는 구식 브라우저에선 지원하진 않지만(폴리필을 쓰면 사용 가능) 대부분의 모던 브라우저가 지원한다.

`fetch()` 기본 문법은 다음과 같다.

```js
let promise = fetch(url, [options])
```

- **`url`** – 접근하고자 하는 URL
- **`options`** – 선택 매개변수, method나 header 등을 지정할 수 있음

`options`에 아무것도 넘기지 않으면 요청은 `GET` 메서드로 진행되어 `url`로부터 콘텐츠가 다운로드 된다.

`fetch()`를 호출하면 브라우저는 네트워크 요청을 보내고 프라미스가 반환된다. 반환되는 프라미스는 `fetch()`를 호출하는 코드에서 사용된다.

응답은 대개 두 단계를 거쳐 진행된다.

**먼저, 서버에서 응답 헤더를 받자마자 `fetch` 호출 시 반환받은 `promise`가 내장 클래스 [Response](https://fetch.spec.whatwg.org/#response-class)의 인스턴스와 함께 이행 상태가 된다.**

이 단계는 아직 본문(body)이 도착하기 전이지만, 개발자는 응답 헤더를 보고 요청이 성공적으로 처리되었는지 아닌지를 확인할 수 있다.

네트워크 문제나 존재하지 않는 사이트에 접속하려는 경우같이 HTTP 요청을 보낼 수 없는 상태에선 프라미스는 거부상태가 된다.

HTTP 상태는 응답 프로퍼티를 사용해 확인할 수 있다.

- **`status`** – HTTP 상태 코드(예: 200)
- **`ok`** – 불린 값. HTTP 상태 코드가 200과 299 사이일 경우 `true`

예시:

```js
let response = await fetch(url);

if (response.ok) { // HTTP 상태 코드가 200~299일 경우
  // 응답 몬문을 받는다(관련 메서드는 아래에서 설명).
  let json = await response.json();
} else {
  alert("HTTP-Error: " + response.status);
}
```

